# Система блокировки платежей Т-Банка

## Описание проекта

Система блокировки платежей Т-Банка — это API-интерфейс, разработанный для управления блокировками платежей юридических лиц. Система позволяет банковскому персоналу эффективно блокировать и разблокировать платежи клиентов, а также отслеживать историю блокировок с учетом российского законодательства и требований Банка России.

## Основные возможности

- Блокировка платежей для конкретных клиентов с указанием причины
- Разблокировка платежей клиентов после устранения проблем
- Проверка статуса блокировки клиента
- Различение блокировок из-за подозрений на мошенничество и технических проблем
- Просмотр истории блокировок для целей аудита и соответствия требованиям ЦБ РФ

## Спецификация API

API системы блокировки платежей реализует RESTful интерфейс и соответствует спецификации OpenAPI 3.0.

### Эндпоинты API

| Метод | Эндпоинт                                 | Описание                                                      |
|-------|------------------------------------------|---------------------------------------------------------------|
| GET   | `/api/v1/health`                         | Проверка работоспособности API                                |
| POST  | `/api/v1/clients/{client_identifier}/block` | Блокировка платежей для конкретного клиента                |
| POST  | `/api/v1/clients/{client_identifier}/unblock` | Разблокировка платежей для конкретного клиента          |
| GET   | `/api/v1/clients/{client_identifier}/status` | Проверка статуса блокировки клиента                      |
| GET   | `/api/v1/clients/{client_identifier}/history` | Получение истории блокировок для клиента                |
| GET   | `/api/v1/blocks`                         | Список всех блокировок с возможностью фильтрации              |

### Примеры использования API

#### Блокировка платежей клиента:

```bash
curl -X POST "http://localhost:5000/api/v1/clients/ООО_КОМПАНИЯ/block" \
     -H "Content-Type: application/json" \
     -d '{
       "reason": "fraud_suspicion",
       "details": "Обнаружена подозрительная схема транзакций",
       "blocked_by": "иванов.и"
     }'
```

#### Проверка статуса блокировки клиента:

```bash
curl -X GET "http://localhost:5000/api/v1/clients/ООО_КОМПАНИЯ/status"
```

#### Разблокировка платежей клиента:

```bash
curl -X POST "http://localhost:5000/api/v1/clients/ООО_КОМПАНИЯ/unblock" \
     -H "Content-Type: application/json" \
     -d '{
       "unblocked_by": "петрова.а",
       "reason": "Расследование завершено, мошенничество не подтверждено"
     }'
```

### Полная спецификация OpenAPI

Полная спецификация API доступна в формате YAML в файле [static/openapi.yaml](static/openapi.yaml) и через веб-интерфейс по адресу `/docs`.

## Структура базы данных

Система использует PostgreSQL для хранения данных о клиентах и блокировках платежей.

### Таблицы

#### Таблица clients

| Поле             | Тип         | Описание                                               |
|------------------|-------------|--------------------------------------------------------|
| id               | Integer     | Первичный ключ                                         |
| client_identifier| String(50)  | Уникальный идентификатор клиента (ИНН/ОГРН)            |
| name             | String(100) | Наименование организации                               |
| created_at       | DateTime    | Дата и время создания записи                           |
| updated_at       | DateTime    | Дата и время последнего обновления записи              |

#### Таблица payment_blocks

| Поле             | Тип         | Описание                                               |
|------------------|-------------|--------------------------------------------------------|
| id               | Integer     | Первичный ключ                                         |
| client_id        | Integer     | Внешний ключ к таблице clients                         |
| reason           | Enum        | Причина блокировки (fraud_suspicion/invalid_details/other) |
| details          | Text        | Дополнительные детали о причине блокировки             |
| is_active        | Boolean     | Статус активности блокировки                           |
| blocked_at       | DateTime    | Дата и время создания блокировки                       |
| unblocked_at     | DateTime    | Дата и время снятия блокировки                         |
| blocked_by       | String(100) | Сотрудник, создавший блокировку                        |
| unblocked_by     | String(100) | Сотрудник, снявший блокировку                          |
| unblock_reason   | Text        | Причина разблокировки                                  |

### Диаграмма отношений

```
+-------------+       +----------------+
|   clients   |       | payment_blocks |
+-------------+       +----------------+
| id          |       | id             |
| identifier  |       | client_id      |
| name        |       | reason         |
| created_at  |       | details        |
| updated_at  |       | is_active      |
+-------------+       | blocked_at     |
       ^              | unblocked_at   |
       |              | blocked_by     |
       +------------->| unblocked_by   |
                      | unblock_reason |
                      +----------------+
```

### Перечисления

#### BlockReason

- `fraud_suspicion` - Подозрение на мошенничество
- `invalid_details` - Недействительные реквизиты
- `other` - Другие причины

## Соответствие законодательству РФ

Система разработана с учетом:

1. Федерального закона №152-ФЗ "О персональных данных"
2. Положения Банка России №382-П "О требованиях к обеспечению защиты информации при осуществлении переводов денежных средств"
3. Рекомендаций по стандартизации Банка России РС БР ИББС-2.5-2014
4. Требований к обеспечению защиты информации в организациях банковской системы РФ

## Технический стек

- **Язык программирования**: Python 3
- **Веб-фреймворк**: Flask
- **ORM**: SQLAlchemy
- **База данных**: PostgreSQL
- **Валидация данных**: Marshmallow
- **Документация API**: Swagger/OpenAPI 3.0
- **Фронтенд**: Bootstrap с темной темой

## Начало работы

### Требования

- Python 3.10+
- PostgreSQL 12+

### Установка

1. Клонировать репозиторий
2. Установить зависимости: `pip install -r requirements.txt`
3. Настроить переменные окружения для подключения к базе данных
4. Запустить сервер: `gunicorn --bind 0.0.0.0:5000 main:app`

## Разработчики

Система разработана Кузьминым Виктором для Кейса для системных аналитиков (зима-весна 2025) Т-Банка.
